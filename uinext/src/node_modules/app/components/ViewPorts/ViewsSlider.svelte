<script>
	import {setContext} from 'svelte';
	import {writable} from 'svelte/store';

	export let currentViewId;

	let views = [];
	let indexByIdsMap = {}

	const _currentViewId = writable();

	const registerView = id => {
		indexByIdsMap = {...indexByIdsMap, [id]: views.length};
		views = [...views, id];
	}

	setContext('views', {
		_currentViewId,
		registerView,
		renderAnyway: true
	});

	$: $_currentViewId = currentViewId;
	$: currentViewIndex = indexByIdsMap[$_currentViewId] ?? 1;
	$: console.log(currentViewIndex)

	// FIXME: alphanumeric ids with mapping to position in array
</script>

<div class='viewport'>
	<div
		class='viewscontainer'
		style='--viewsCount: {views.length}; --currentViewId: {currentViewIndex}'
	>
		<slot />
	</div>
</div>

<style>
	.viewport {
		width: 100%;
		height: 100%;
	}
	.viewscontainer {
		width: calc( 100% * var(--viewsCount) );
		height: 100%;
		display: grid;
		grid-template-columns: calc( 100% / var(--viewsCount) );
		grid-auto-flow: column;
		transform: translateX(calc( var(--currentViewId) * -100%  / var(--viewsCount)));
		transition:
			transform
			0.25s
			ease;
	}
</style>
