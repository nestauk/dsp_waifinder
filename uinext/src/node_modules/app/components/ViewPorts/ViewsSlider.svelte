<script>
	import {setContext} from 'svelte';
	import {writable} from 'svelte/store';

	export let viewId;

	let viewsCount = 0;
	let indexByIdsMap = {}

	const _viewId = writable();

	const registerView = id => {
		indexByIdsMap = {...indexByIdsMap, [id]: viewsCount++};
	}

	setContext('viewport', {
		_viewId,
		registerView
	});

	$: $_viewId = viewId;
	$: currentViewIndex = indexByIdsMap[$_viewId] ?? 1;
</script>

<div class='viewport'>
	<div
		class='viewscontainer'
		style='--viewsCount: {viewsCount}; --currentViewIndex: {currentViewIndex}'
	>
		<slot />
	</div>
</div>

<style>
	.viewport {
		width: 100%;
		height: 100%;
	}
	.viewscontainer {
		width: calc( 100% * var(--viewsCount) );
		height: 100%;
		display: grid;
		grid-template-columns: repeat(var(--viewsCount), calc( 100% / var(--viewsCount) ));
		grid-auto-flow: column;
		transform: translateX(calc( var(--currentViewIndex) * -100% / var(--viewsCount)));
		transition:
			transform
			0.25s
			ease;
	}
</style>
