<script>
	import colorParse from 'color-parse';
	import * as _ from 'lamb';
	import {containsOneOf, makePrefixed} from '@svizzle/utils';

	import StyleDriver from 'app/components/svizzle/StyleDriver.svelte';
	import {_currThemeVars, _themeName, _themeVars} from 'app/stores/theme';
import { prop_dev } from 'svelte/internal';

	const getVarNames = _.pipe([
		_.keys,
		_.filterWith(containsOneOf(['color']))
	]);
	const hexValue = number => number.toString(16);
	const getRGBColor = themeVars => _.pipe([
		_.curry(_.getIn)(themeVars),
		colorParse,
		_.getKey('values'),
		_.mapWith(hexValue),
		_.joinWith(''),
		makePrefixed('#')
	]);

	const getRGBAColor = themeVars => _.pipe([
		_.curry(_.getIn)(themeVars),
		colorParse,
		_.collect([
			_.getKey('values'),
			_.pipe([
				_.getKey('alpha'),
				_.multiplyBy(255)
			])
		]),
		_.flatten,
		_.mapWith(hexValue),
		_.joinWith(''),
		makePrefixed('#')
	]);
	const setColor = (prop, value) => {
		$_themeVars[`.${$_themeName}`][prop] = value
	};
	$: console.log('themeVars', $_themeVars);
	$: console.log('currThemeVars', $_currThemeVars);
	$: varNames = $_currThemeVars ? getVarNames($_currThemeVars) : [];
</script>

<StyleDriver
	href='/css/global.css'
	styleRules={$_themeVars}
/>

<section
class='styleEditor'
>
	Current Style: {$_themeName}
	<table>
		{#each varNames as varName}
			<tr>
				<td>{varName}</td>
				<td>
					<input
						value={getRGBColor($_currThemeVars)(varName)}
						type='color'
						on:change={({target: {value}}) => setColor(varName, value)}
					/>
				</td>
			</tr>
		{/each}
	</table>
</section>
