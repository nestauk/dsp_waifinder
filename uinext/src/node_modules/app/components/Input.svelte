<script>
	import {createEventDispatcher, onMount} from 'svelte';
	import Icon from '@svizzle/ui/src/icons/Icon.svelte';
	import X from '@svizzle/ui/src/icons/feather/X.svelte';

	export let ariaLabel = 'Clear text';
	export let autofocus = false;
	export let placeholder;
	export let type = 'text';
	export let value;

	let input;

	const dispatch = createEventDispatcher();

	const onInput = e => {
		({value} = e.target);
	}
	const onKeyPress = e => {
		if (e.keyCode === 13) {
			e.preventDefault();
			dispatch('submitted');
		}
	};

	const reset = () => {
		value = ''
	};

	onMount(() => {
		// https://github.com/sveltejs/sapper/issues/619#issuecomment-480616597
		if (autofocus) {
			setTimeout(() => {
				input.focus();
			}, 100);
		}
	});
</script>

<div class='Input'>
	<!-- svelte-ignore a11y-autofocus -->
	<input
		{autofocus}
		bind:this={input}
		on:keypress={onKeyPress}
		on:input={onInput}
		{placeholder}
		{type}
	/>
	{#if value !== ''}
		<button
			aria-label={ariaLabel}
			class='clickable'
			on:click={reset}
		>
			<Icon glyph={X} size=16 strokeWidth='1px' />
		</button>
	{/if}
</div>

<style>
	.Input {
		border: thin solid var(--color-grey-70);
		border-radius: 0.125em;
		display: grid;
		grid-template-columns: 1fr 24px;
		padding: 0.25em;
		width: 100%;
	}

	.Input:focus-within {
		border-width: 2px;
		padding: calc(0.25em - 1px);
	}

	input {
		border: none;
		font-size: 1em;
		width: 100%;
	}
	input:focus {
		outline: none;
		border: none;
	}

	button {
		background: none;
		border: none;
	}
</style>
