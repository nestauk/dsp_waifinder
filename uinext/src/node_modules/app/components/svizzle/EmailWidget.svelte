<script>
	import {createEventDispatcher} from 'svelte';
	// FIXME Consider RFC 5322 compliant email validation
	import emailRegex from 'email-regex';

	import Input from 'app/components/svizzle/Input.svelte';

	export let buttonText = 'Submit';
	export let hasButton = true;

	let userEmail = '';

	const dispatch = createEventDispatcher();

	const onSubmitEmail = () => {
		if (isValidEmail) {
			dispatch('emailSubmitted', userEmail);
		}
	};

	const regex = emailRegex({exact: true});

	$: isValidEmail = regex.test(userEmail);
</script>

<div class='EmailWidget'>
	<div class='controls'>
		<Input
			autofocus=true
			bind:value={userEmail}
			borderColor={!isValidEmail && 'red'}
			on:submitted={onSubmitEmail}
			placeholder='Please insert your email'
			type='email'
		/>
		{#if hasButton}
			<button
				disabled={!isValidEmail}
				on:click={onSubmitEmail}
			>
				{buttonText}
			</button>
		{/if}
	</div>
</div>

<style>
	.EmailWidget {
		align-items: center;
		display: grid;
		grid-template-columns: 1fr;
		height: 100%;
		justify-items: center;
		padding: 1em;
		width: 100%;
	}
	.controls {
		column-gap: 0.5em;
		display: grid;
		grid-template-columns: 1fr min-content;
		max-width: 20em;
		width: 100%;
	}
	button {
		border-radius: 0.125em;
		border: thin solid var(--color-grey-70);
		font-size: 1em;
		padding: 0.25em;
	}
</style>
