<script>
	import {setupResizeObserver} from '@svizzle/ui/src/actions/resizeObserver';

	export let blurRadius = '4px';

	let scroller;
	let hasTopShadow;
	let hasBottomShadow;
	let tsOpacity = 1;
	let bsOpacity = 1;

	const {
		_writable: _size,
		resizeObserver
	} = setupResizeObserver();

	const onScroll = () => {
		const {
			offsetHeight,
			scrollTop,
			scrollHeight
		} = scroller;
		const scrollEnd = scrollTop + offsetHeight;
		const scrollBottom = scrollHeight - scrollEnd;

		hasTopShadow = scrollTop > 0;
		hasBottomShadow = scrollHeight > scrollEnd;
		tsOpacity = scrollTop < 10 ? scrollTop / 10 : 1;
		bsOpacity = scrollBottom < 10
			? scrollBottom / 10
			: 1;
	};

	$: style = `
	--ts-opacity: ${tsOpacity};
	--bs-opacity: ${bsOpacity};
	--blur-radius: ${blurRadius};
	`;
	$: scroller && $_size && onScroll();
</script>

<div
	bind:this={scroller}
	class='Scroller'
	class:shadowTop={hasTopShadow}
	class:shadowBottom={hasBottomShadow}
	{style}
	on:scroll={onScroll}
	use:resizeObserver
>
	<slot/>
</div>

<style>
	.Scroller {
		height: 100%;
		overflow: auto;
		position: relative;
		z-index: 1;
	}

	.shadowTop {
		box-shadow: inset 0px 12px 13px -13px rgba(211, 211, 211, var(--ts-opacity));
	}
	.shadowBottom {
		box-shadow: inset 0px -12px 13px -13px rgba(211, 211, 211, var(--bs-opacity));
	}
	.shadowTop.shadowBottom {
		box-shadow:
			inset 0px 12px 13px -13px rgba(211, 211, 211, var(--ts-opacity)),
			inset 0px -12px 13px -13px rgba(211, 211, 211, var(--bs-opacity));
	}
</style>
