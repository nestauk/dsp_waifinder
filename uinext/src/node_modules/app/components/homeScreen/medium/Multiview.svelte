<script>
	import BarchartVDiv from '@svizzle/barchart/src/BarchartVDiv.svelte';

	import Details from 'app/components/details/Details.svelte';
	import View from 'app/components/ViewPorts/View.svelte';
	import ViewsSlider from 'app/components/ViewPorts/ViewsSlider.svelte';
	import {
		_keyPlaceLabelValueOrgsCount,
		_keyRegionLabelValueOrgsCount,
		_keyTopicIdValueOrgsCount,
		_orgs,
	} from 'app/stores/data';
	import {_minScore} from 'app/stores/topics';
	import {_activeViewId, setActiveView} from 'app/stores/navigation';
	import {
		asyncUpdateTopicDetails,
		clearActiveTopic
	} from 'app/stores/topics';
	import {getTopicLabel} from 'app/utils/dataUtils';

	import MultiviewSelector from './MultiviewSelector.svelte';
</script>

<div class='Multiview'>
	<div class='slider'>
		<ViewsSlider viewId={$_activeViewId}>
			<View id='details'>
				<Details
					items={$_orgs}
					minScore={$_minScore}
				/>
			</View>
			<View id='bytopic'>
				<div class='scrollable'>
					<BarchartVDiv
						isInteractive={true}
						items={$_keyTopicIdValueOrgsCount}
						keyToLabelFn={getTopicLabel}
						on:entered={({detail: {id}}) => asyncUpdateTopicDetails(id)}
						on:exited={clearActiveTopic}
					/>
				</div>
			</View>
			<View id='byplace'>
				<div class='scrollable'>
					<BarchartVDiv
						items={$_keyPlaceLabelValueOrgsCount}
					/>
				</div>
			</View>
			<View id='byregion'>
				<div class='scrollable'>
					<BarchartVDiv
						items={$_keyRegionLabelValueOrgsCount}
					/>
				</div>
			</View>
		</ViewsSlider>
	</div>
	<div>
		<MultiviewSelector setView={setActiveView}/>
	</div>
</div>

<style>
	.Multiview {
		display: grid;
		grid-auto-flow: row;
		grid-template-rows: 1fr min-content;
		grid-template-columns: 100%;
		height: 100%;
	}
	.slider {
		height: 100%;
		overflow: hidden;
	}

	/* TBD */
	.scrollable {
		height: 100%;
		overflow: auto;
	}
</style>
