<script>
	import Mapbox from 'app/components/Map/Mapbox.svelte';
	import SvgLayers from 'app/components/Map/SvgLayers.svelte';
	import Results from 'app/components/Results/Results.svelte';
	import Settings from 'app/components/Settings.svelte';
	import View from 'app/components/ViewPorts/View.svelte'
	import ViewsSlider from 'app/components/ViewPorts/ViewsSlider.svelte'
	import ViewSelector from 'app/components/ViewSelector.svelte';

	import {
		MAPBOXGL_ACCESSTOKEN as accessToken,
		MAPBOXGL_STYLEURL as styleURL
	} from 'app/config';
	import {_maxScore} from 'app/stores';

	const showView = id => viewId = id;

	export let getLonLat;
	export let items = [];

	let viewId = 'map';
</script>

<div class='container'>
	<div class='slider'>
		<ViewsSlider {viewId}>
			<View id='settings'>
				<Settings />
			</View>
			<View id='map'>
				<Mapbox
					{accessToken}
					{getLonLat}
					{items}
					{styleURL}
					CustomLayers={SvgLayers}
					withScaleControl={true}
					withZoomControl={true}
				/>
			</View>
			<View id='results'>
				<Results
					{items}
					maxScore={$_maxScore}
				/>
			</View>
		</ViewsSlider>
	</div>
	<div>
		<ViewSelector {showView}/>
	</div>
</div>

<style>
	.container {
		display: grid;
		grid-auto-flow: row;
		grid-template-rows: 1fr min-content;
		height: 100%;
	}
	.slider {
		height: 100%;
		overflow: hidden;
	}
</style>
