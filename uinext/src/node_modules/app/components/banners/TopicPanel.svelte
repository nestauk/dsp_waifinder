<script>
	import LoadingView from '@svizzle/ui/src/LoadingView.svelte';
	import * as _ from 'lamb';

	import {getFirstPhrases} from 'app/utils/dataUtils';

	export let details;

	let isImgErrored = false;

	const notifyImgError = () => {
		isImgErrored = true;
	}

	$: title = details?.label ?? '';
	$: abstract = details?.abstract
		? getFirstPhrases(details.abstract, 300)
		: 'No info';
	$: thumbnailURL = details?.thumbnailURL;
</script>

{#if details.isLoading}
	<LoadingView />
{:else}
	<h2>{title}</h2>
	{#if thumbnailURL && !isImgErrored}
		<img
			alt='Topic thumbnail.'
			on:error={notifyImgError}
			src={thumbnailURL}
		/>
	{/if}
	<p>
		{abstract}
	</p>
{/if}

<style>
	img {
		float: right;
		max-width: 50%;
		max-height: 10em;
		margin: 0.5em;
	}
</style>
