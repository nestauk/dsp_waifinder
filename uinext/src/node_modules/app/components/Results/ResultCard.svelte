<script>
	import Link from '@svizzle/ui/src/Link.svelte';
	import Icon from '@svizzle/ui/src/icons/Icon.svelte';
	import LinkIcon from '@svizzle/ui/src/icons/feather/Link.svelte';
	import * as _ from 'lamb';

	import Pill from 'app/components/Results/Pill.svelte';

	export let item;
	export let maxScore = 50;

	const getTopicLabel = _.replace(/_/g, ' ');

	$: postCode = item?.location?.postcode || '';
	$: place = item?.place?.name || '';
	$: sep = (postCode && place) ? ' - ' : '';
	$: address = `${postCode}${sep}${place}`;
	$: topics = _.filter(item?.topics || [], ({score}) => score >= maxScore);
</script>

<div class='ResultCard'>
	<p>
		<span class='name'>{item?.name || ''}</span>
		{#if item?.url}
			<Link
				href={item.url}
				target='_blank'
			>
				<Icon
					glyph={LinkIcon}
					size={20}
				/>
			</Link>
		{/if}
	</p>
	<p class='description'>{item?.description || ''}</p>
	{#if address !== ''}
		<div class='address'>
			<span>{address}</span>
		</div>
	{/if}
	<div class='topics'>
		{#each topics as {id, score}}
			<Link
				href='https://en.wikipedia.org/wiki/{id}'
				target='_blank'
			>
				<Pill
					{score}
					label={getTopicLabel(id)}
				/>
			</Link>
		{/each}
	</div>
</div>

<style>
	.ResultCard {
		display: grid;
		gap: 0.8em;
		padding: 1em;
	}

	.name {
		font-size: 1.2em;
	}

	.address {
		display: flex;
		align-items: center;
		justify-content: right;
	}
	.address span {
		background-color: aquamarine;
		font-style: italic;
		text-align: right;
		padding: 0.2em 0.5em;
	}

	.description {
		/* These `-webkit` properties work in Firefox and Edge and Safari 15.4. */
		-webkit-box-orient: vertical;
		-webkit-line-clamp: 3;
		display: -webkit-box;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.topics {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 0.4em;
	}
</style>
