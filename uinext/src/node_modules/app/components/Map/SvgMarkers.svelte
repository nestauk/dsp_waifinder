<script>
	import * as _ from 'lamb';

	import {_dataset} from 'app/stores/dataset';
	import {
		_hero,
		setFocusedHeroFromMap,
		setSelectedHero
	} from 'app/stores/interaction';
	import {_isSmallScreen} from 'app/stores/layout';

	export let getLonLat = _.identity;
	export let items = [];
	export let projectFn = _.identity;

	$: projectItem = item => ({...item, ...projectFn(getLonLat(item))});
	$: markers = projectFn && getLonLat && _.map(items, projectItem) || [];
	$: hero =
		$_hero?.org && projectFn && getLonLat &&
		projectFn(getLonLat($_hero?.org));
</script>

<g class='SvgMarkers'>
	{#each markers as {x, y, id}}
		<circle
			class='marker'
			cx={x}
			cy={y}
			r={$_isSmallScreen ? 5 : 3}
			on:click|stopPropagation={() => setSelectedHero(id)}
			on:dblclick|stopPropagation
			on:mouseenter={$_isSmallScreen
				? null
				: () => setFocusedHeroFromMap(id)
			}
			on:mouseleave={$_isSmallScreen
				? null
				:() => setFocusedHeroFromMap(null)
			}
		/>
	{/each}
	{#if hero}
		<circle
			class='marker focused'
			cx={hero.x}
			cy={hero.y}
			r=6
		/>
	{/if}
</g>

<style>
	.marker {
		cursor: pointer;
		fill-opacity: 0.75;
	}

	.focused {
		fill: red;
		pointer-events: none;
	}
</style>
