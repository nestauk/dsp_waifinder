import {derived, writable, get} from 'svelte/store';

import {_dataset} from 'app/stores/dataset';
import {_bbox_WSEN} from 'app/stores/selection';
/* hero */

export const _hero = writable(null);

export const clearHero = () => {
	_hero.set(null);
}

export const setHero = ({id, isPinned, isVisible}) => {
	let hero;
	const {orgsById} = get(_dataset);
	const org = orgsById[id];
	if (org) {
		hero = {
			isVisible,
			isPinned,
			org
		};
	}
	_hero.set(hero);
};

export const clearInteractionStores = () => {
	_hero.update(hero => hero?.isPinned ? hero : null);
}

const makeIsCoordWithinBBox = ([w, s, e, n]) => ({lat, lon}) =>
	lon >= w &&
	lat >= s &&
	lon <= e &&
	lat <= n;

export const _isHeroInBounds = derived(
	[_bbox_WSEN, _hero],
	([bbox_WSEN, hero]) => Boolean(hero)
		&& makeIsCoordWithinBBox(bbox_WSEN)(hero.org.location)
);

/* map */

export const _isCursorOnMap = writable(false);

export const setIsCursorOnMap = () => _isCursorOnMap.set(true);
export const clearIsCursorOnMap = () => _isCursorOnMap.set(false);
