import {get, writable} from 'svelte/store';
import {getNextIds, getOrgById} from 'app/utils/eval';
import {_deviceId} from 'app/stores/device';
import {getDeviceId} from 'app/utils/device';

const chunkSize = 100;

let orgIds = [];

export const _currentOrg = writable();
export const _evaluations = writable();

export const loadNextOrg = async () => {
	if (orgIds.length === 0) {
		let deviceId = get(_deviceId);
		if (!deviceId) {
			deviceId = await getDeviceId();
			_deviceId.set(deviceId);
		}
		const response = await getNextIds(deviceId, chunkSize);
		// eslint-disable-next-line prefer-destructuring
		orgIds = response.orgIds;
	}
	const nextOrg = await getOrgById(orgIds.shift())
	_currentOrg.set(nextOrg.org);
};
