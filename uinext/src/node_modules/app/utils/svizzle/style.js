import * as _ from 'lamb';

const parseCssText = cssText => cssText
.split(';')
.filter(attribDef => attribDef?.length)
.map(attribDef =>
	attribDef
	.split(':')
	.map(token => token.trim())
);

export const getStylesheet = pHref => _.find(
	[...document.styleSheets],
	_.hasKeyValue('href', pHref)
);

export const makeGetStyleRulesObj = selectorRegex => _.pipe([
	_.filterWith(_.pipe([
		_.getKey('selectorText'),
		selectorRegex.test.bind(selectorRegex)
	])),
	_.mapWith(_.collect([
		_.getKey('selectorText'),
		_.pipe([
			_.getPath('style.cssText'),
			parseCssText,
			_.fromPairs
		])
	])),
	_.fromPairs
]);
